<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>elasticsearch_indices - HADeploy</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../..">HADeploy</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                    <li >
                        <a href="../../../installation/">Installation</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../getting_started/first_step/">First step</a>
</li>
                            
<li >
    <a href="../../../getting_started/next_step/">Next step</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Core</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core/encrypted_vars/">encrypted_vars</a>
</li>
            
<li >
    <a href="../../core/excluded_scopes/">excluded_scopes</a>
</li>
            
<li >
    <a href="../../core/include/">include</a>
</li>
            
<li >
    <a href="../../core/included_scopes/">included_scopes</a>
</li>
            
<li >
    <a href="../../core/vars/">vars</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ansible</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ansible/ansible_overview/">Overview</a>
</li>
            
<li >
    <a href="../../ansible/ansible_playbooks/">ansible_playbooks</a>
</li>
            
<li >
    <a href="../../ansible/playbooks_folders/">playbooks_folders</a>
</li>
            
<li >
    <a href="../../ansible/roles_folders/">roles_folders</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ansible_inventories</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ansible_inventories/ansible_inventories/">ansible_inventories</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Elasticsearch</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">elasticsearch_indices</a>
</li>
            
<li >
    <a href="../elasticsearch_servers/">elasticsearch_servers</a>
</li>
            
<li >
    <a href="../elasticsearch_templates/">elasticsearch_templates</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Files</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../files/files/">files</a>
</li>
            
<li >
    <a href="../../files/folders/">folders</a>
</li>
            
<li >
    <a href="../../files/maven_repositories/">maven_repositories</a>
</li>
            
<li >
    <a href="../../files/local_files_folders/">local_files_folders</a>
</li>
            
<li >
    <a href="../../files/local_templates_folders/">local_templates_folders</a>
</li>
            
<li >
    <a href="../../files/trees/">trees</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">HBase</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hbase/hbase_datasets/">hbase_datasets</a>
</li>
            
<li >
    <a href="../../hbase/hbase_namespaces/">hbase_namespaces</a>
</li>
            
<li >
    <a href="../../hbase/hbase_relay/">hbase_relay</a>
</li>
            
<li >
    <a href="../../hbase/hbase_tables/">hbase_tables</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Hdfs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hdfs/hdfs_relay/">hdfs_relay</a>
</li>
            
<li >
    <a href="../../hdfs/source_host_credentials/">source_host_credentials</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Hive</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hive/hive_databases/">hive_databases</a>
</li>
            
<li >
    <a href="../../hive/hive_relay/">hive_relay</a>
</li>
            
<li >
    <a href="../../hive/hive_tables/">hive_tables</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Inventory</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../inventory/exit_on_fail/">exit_on_fail</a>
</li>
            
<li >
    <a href="../../inventory/hosts/">hosts</a>
</li>
            
<li >
    <a href="../../inventory/host_groups/">host_groups</a>
</li>
            
<li >
    <a href="../../inventory/host_group_overrides/">host_group_overrides</a>
</li>
            
<li >
    <a href="../../inventory/host_overrides/">host_overrides</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Kafka</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../kafka/kafka_relay/">kafka_relay</a>
</li>
            
<li >
    <a href="../../kafka/kafka_topics/">kafka_topic</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ranger</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ranger/hbase_ranger_policies/">hbase_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/hdfs_ranger_policies/">hdfs_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/hive_ranger_policies/">hive_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/kafka_ranger_policies/">kafka_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/ranger_relay/">ranger_relay</a>
</li>
            
<li >
    <a href="../../ranger/storm_ranger_policies/">storm_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/yarn_ranger_policies/">yarn_ranger_policies</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Storm</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../storm/storm_overview/">storm_overview</a>
</li>
            
<li >
    <a href="../../storm/storm_relay/">storm_relay</a>
</li>
            
<li >
    <a href="../../storm/storm_topologies/">storm_topologies</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Systemd</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../systemd/systemd_units/">systemd_units</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Supervisors</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../supervisor/supervisor_overview/">Overview</a>
</li>
            
<li >
    <a href="../../supervisor/supervisors/">supervisors</a>
</li>
            
<li >
    <a href="../../supervisor/supervisor_groups/">supervisor_groups</a>
</li>
            
<li >
    <a href="../../supervisor/supervisor_programs/">supervisor_programs</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Users</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../users/groups/">groups</a>
</li>
            
<li >
    <a href="../../users/users/">users</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Yarn</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../yarn/yarn_overview/">yarn_overview</a>
</li>
            
<li >
    <a href="../../yarn/yarn_relay/">yarn_relay</a>
</li>
            
<li >
    <a href="../../yarn/yarn_services/">yarn_service</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../more/conditional_deployment/">Conditional deployment</a>
</li>
                            
<li >
    <a href="../../../more/under_the_hood/">Under the hood</a>
</li>
                            
<li >
    <a href="../../../more/execution_order/">Execution order</a>
</li>
                            
<li >
    <a href="../../../more/altering_scope/">Altering scope</a>
</li>
                            
<li >
    <a href="../../../more/secured_cluster/">Secured cluster</a>
</li>
                            
<li >
    <a href="../../../more/yaml_tricks/">YAML tricks</a>
</li>
                            
<li >
    <a href="../../../more/release_notes/">Release notes</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../../ansible_inventories/ansible_inventories/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../elasticsearch_servers/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#elasticsearch_indices">elasticsearch_indices</a></li>
            <li><a href="#synopsis">Synopsis</a></li>
            <li><a href="#attributes">Attributes</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#idempotency">Idempotency</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="elasticsearch_indices">elasticsearch_indices</h1>
<h2 id="synopsis">Synopsis</h2>
<p>Allow definition of a list of Elasticsearch indices.</p>
<h2 id="attributes">Attributes</h2>
<p>Each item of the list has the following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>req?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>server</td>
<td>yes</td>
<td>The server this index will be created on. Refer to the logical name attribute of an <a href="../elasticsearch_servers"><code>elasticsearch_servers</code></a> list item.</td>
</tr>
<tr>
<td>name</td>
<td>yes</td>
<td>The name of this index.</td>
</tr>
<tr>
<td>definition</td>
<td>yes</td>
<td>Index definition as a json string or as a YAML definition. See examples</td>
</tr>
<tr>
<td>recreate</td>
<td>no</td>
<td>Boolean: Will trigger Index destruction before recreating it. WARNING: All data will be lost!. Use with care.<br>Default: <code>no</code>.</td>
</tr>
<tr>
<td>no_remove</td>
<td>no</td>
<td>Boolean: Prevent this index to be removed when HADeploy will be used in REMOVE mode.<br>Default: <code>no</code></td>
</tr>
<tr>
<td>when</td>
<td>no</td>
<td>Boolean. Allow <a href="../../../more/conditional_deployment">conditional deployment</a> of this item.<br>Default <code>True</code></td>
</tr>
</tbody>
</table>
<h2 id="example">Example</h2>
<p>In the following, the definition is provided as a JSON text:</p>
<pre><code class="yaml">elasticsearch_indices:
- server: elastic1
  name: test1a
  definition: |
    {
        &quot;settings&quot; : {
            &quot;index&quot;: {
                &quot;number_of_shards&quot; : 3,
                &quot;number_of_replicas&quot;: 3
            }
        },
        &quot;mappings&quot; : {
            &quot;type1&quot; : {
                &quot;properties&quot; : {
                    &quot;field1&quot; : { &quot;type&quot; : &quot;text&quot; }
                }
            }
        }
    }  
</code></pre>

<p>It also can be provided in 'pure' YAML form:</p>
<pre><code class="yaml">elasticsearch_indices:
- server: elastic1
  name: test1a
  definition:
    settings:
      index:
        number_of_shards: 3
        number_of_replicas: 3
    mappings:
      type1:
        properties:
          field1:
            type: text

</code></pre>

<h2 id="idempotency">Idempotency</h2>
<p>Idempotency is one of the key features of HADeploy. In our case, this means creating an index is not just issuing a PUT on the server. We need to take current server state in account.</p>
<p>So, when required to create an Index, HADeploy will:</p>
<ul>
<li>First, try to retrieve a index of the same name.</li>
<li>If there is no such index, just create it and return successfully. This is the simplest case.</li>
<li>If there is one, compare the existing definition to the provided one. In most case, the existing definition is richer than the one used to create it, 
as Elasticsearch engine populate it with some default value or some other meta-informations. 
So, this comparison try to figure out if all items provided by our definition are included in the current existing one.</li>
<li>If yes, this means existing index is compliant with our provided definition. So, we can stop processing and return successfully.</li>
<li>If no, the module will try to adjust if possible. For this it can use the 
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html">Update Indices Settings</a> elasticsearch API or the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html">Put Mapping</a> one.</li>
</ul>
<p>Note that such adjustment have some limitation. For example, one can update the <code>number_of_replicas</code>, but not the <code>number_of_shards</code>. Refer to the links to the API above for more information about what can be updated in an open index.</p>
<p>In the case where index can't be updated to fulfill provided definition, an error is generated. </p>
<p>Another point to take in account is, for the comparison to be effective, the provided definition must be defined as it will be retrieved by the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-get-index.html">Get index</a> API.</p>
<p>For example, when retrieving an index, you will get the setting definition like:</p>
<pre><code class="yaml">{
    &quot;settings&quot; : {
        &quot;index&quot; : {
            &quot;number_of_shards&quot; : 3, 
            &quot;number_of_replicas&quot; : 2 
        }
    }
}
</code></pre>

<p>But the elastic documentation state than you can also use a simplified form:</p>
<pre><code class="yaml">{
    &quot;settings&quot; : {
        &quot;number_of_shards&quot; : 3,
        &quot;number_of_replicas&quot; : 2
    }
}
</code></pre>

<p>DON'T USE THIS SIMPLIFIED FORM in you index definition. It will mislead comparison thus generating errors.</p>
<h3 id="default-values">Default values.</h3>
<p>Another common issue is default value handling. For example </p>
<pre><code class="yaml">   {
        .....
        &quot;mappings&quot; : {
            &quot;type1&quot; : {
                &quot;properties&quot; : {
                    &quot;field1&quot; : { &quot;type&quot; : &quot;text&quot;, &quot;index&quot;: true }
                }
            }
        }
    }  
</code></pre>

<p>Will generate an error. One must write:</p>
<pre><code class="yaml">   {
        .....
        &quot;mappings&quot; : {
            &quot;type1&quot; : {
                &quot;properties&quot; : {
                    &quot;field1&quot; : { &quot;type&quot; : &quot;text&quot; }
                }
            }
        }
    }  
</code></pre>

<p>This because this is how the mapping is defined when retrieving index definition by GET API. (<code>"index": true</code> is the default). </p>
<p>Of course, if you want to prevent some fields to be indexed, you will write:</p>
<pre><code class="yaml">   {
        .....
        &quot;mappings&quot; : {
            &quot;type1&quot; : {
                &quot;properties&quot; : {
                    &quot;field1&quot; : { &quot;type&quot; : &quot;text&quot;, &quot;index&quot;: false }
                }
            }
        }
    }  
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

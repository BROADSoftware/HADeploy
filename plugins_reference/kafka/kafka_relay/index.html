<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>kafka_relay - HADeploy</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../..">HADeploy</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                    <li >
                        <a href="../../../installation/">Installation</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../getting_started/first_step/">First step</a>
</li>
                            
<li >
    <a href="../../../getting_started/next_step/">Next step</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Core</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../core/encrypted_vars/">encrypted_vars</a>
</li>
            
<li >
    <a href="../../core/excluded_scopes/">excluded_scopes</a>
</li>
            
<li >
    <a href="../../core/include/">include</a>
</li>
            
<li >
    <a href="../../core/included_scopes/">included_scopes</a>
</li>
            
<li >
    <a href="../../core/vars/">vars</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ansible</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ansible/ansible_overview/">Overview</a>
</li>
            
<li >
    <a href="../../ansible/ansible_playbooks/">ansible_playbooks</a>
</li>
            
<li >
    <a href="../../ansible/playbooks_folders/">playbooks_folders</a>
</li>
            
<li >
    <a href="../../ansible/roles_folders/">roles_folders</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ansible_inventories</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ansible_inventories/ansible_inventories/">ansible_inventories</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Elasticsearch</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../elastic/elasticsearch_indices/">elasticsearch_indices</a>
</li>
            
<li >
    <a href="../../elastic/elasticsearch_servers/">elasticsearch_servers</a>
</li>
            
<li >
    <a href="../../elastic/elasticsearch_templates/">elasticsearch_templates</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Files</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../files/files/">files</a>
</li>
            
<li >
    <a href="../../files/folders/">folders</a>
</li>
            
<li >
    <a href="../../files/maven_repositories/">maven_repositories</a>
</li>
            
<li >
    <a href="../../files/local_files_folders/">local_files_folders</a>
</li>
            
<li >
    <a href="../../files/local_templates_folders/">local_templates_folders</a>
</li>
            
<li >
    <a href="../../files/trees/">trees</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">HBase</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hbase/hbase_datasets/">hbase_datasets</a>
</li>
            
<li >
    <a href="../../hbase/hbase_namespaces/">hbase_namespaces</a>
</li>
            
<li >
    <a href="../../hbase/hbase_relay/">hbase_relay</a>
</li>
            
<li >
    <a href="../../hbase/hbase_tables/">hbase_tables</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Hdfs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hdfs/hdfs_relay/">hdfs_relay</a>
</li>
            
<li >
    <a href="../../hdfs/source_host_credentials/">source_host_credentials</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Hive</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../hive/hive_databases/">hive_databases</a>
</li>
            
<li >
    <a href="../../hive/hive_relay/">hive_relay</a>
</li>
            
<li >
    <a href="../../hive/hive_tables/">hive_tables</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Inventory</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../inventory/exit_on_fail/">exit_on_fail</a>
</li>
            
<li >
    <a href="../../inventory/hosts/">hosts</a>
</li>
            
<li >
    <a href="../../inventory/host_groups/">host_groups</a>
</li>
            
<li >
    <a href="../../inventory/host_group_overrides/">host_group_overrides</a>
</li>
            
<li >
    <a href="../../inventory/host_overrides/">host_overrides</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Kafka</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">kafka_relay</a>
</li>
            
<li >
    <a href="../kafka_topics/">kafka_topic</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Ranger</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../ranger/hbase_ranger_policies/">hbase_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/hdfs_ranger_policies/">hdfs_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/hive_ranger_policies/">hive_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/kafka_ranger_policies/">kafka_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/ranger_relay/">ranger_relay</a>
</li>
            
<li >
    <a href="../../ranger/storm_ranger_policies/">storm_ranger_policies</a>
</li>
            
<li >
    <a href="../../ranger/yarn_ranger_policies/">yarn_ranger_policies</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Storm</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../storm/storm_overview/">storm_overview</a>
</li>
            
<li >
    <a href="../../storm/storm_relay/">storm_relay</a>
</li>
            
<li >
    <a href="../../storm/storm_topologies/">storm_topologies</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Systemd</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../systemd/systemd_units/">systemd_units</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Supervisors</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../supervisor/supervisor_overview/">Overview</a>
</li>
            
<li >
    <a href="../../supervisor/supervisors/">supervisors</a>
</li>
            
<li >
    <a href="../../supervisor/supervisor_groups/">supervisor_groups</a>
</li>
            
<li >
    <a href="../../supervisor/supervisor_programs/">supervisor_programs</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Users</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../users/groups/">groups</a>
</li>
            
<li >
    <a href="../../users/users/">users</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">Yarn</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../yarn/yarn_overview/">yarn_overview</a>
</li>
            
<li >
    <a href="../../yarn/yarn_relay/">yarn_relay</a>
</li>
            
<li >
    <a href="../../yarn/yarn_services/">yarn_service</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">More <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../../more/conditional_deployment/">Conditional deployment</a>
</li>
                            
<li >
    <a href="../../../more/under_the_hood/">Under the hood</a>
</li>
                            
<li >
    <a href="../../../more/execution_order/">Execution order</a>
</li>
                            
<li >
    <a href="../../../more/altering_scope/">Altering scope</a>
</li>
                            
<li >
    <a href="../../../more/secured_cluster/">Secured cluster</a>
</li>
                            
<li >
    <a href="../../../more/yaml_tricks/">YAML tricks</a>
</li>
                            
<li >
    <a href="../../../more/release_notes/">Release notes</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../../inventory/host_overrides/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../kafka_topics/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#kafka_relay">kafka_relay</a></li>
            <li><a href="#synopsis">Synopsis</a></li>
            <li><a href="#attributes">Attributes</a></li>
            <li><a href="#kerberos-authentication">Kerberos authentication</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#tricks">Tricks</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="kafka_relay">kafka_relay</h1>
<h2 id="synopsis">Synopsis</h2>
<p>Issuing some commands to specifics subsystem, such as Apache Kafka require a quite complex client configuration.</p>
<p>To avoid this, HADeploy will not issue such command directly, but push the command on one of the cluster node, called ’Relay node'.</p>
<p><code>kafka_relay</code> will define which host will be used to relay operations for Kafka, and also how these operations will be performed.</p>
<p>There should be only one entry of this type in the HADeploy definition file.</p>
<h2 id="attributes">Attributes</h2>
<p><code>kafka_relay</code> is a map with the following attributes:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>req?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>host</td>
<td>yes</td>
<td>The host on which all Kafka commands will be pushed for execution. THIS HOST MUST HAVE KAFKA INSTALLED ON. This can be validated by trying to locate and use commanes such as <code>kafka-topic.sh</code>.</td>
</tr>
<tr>
<td>zk_host_group</td>
<td>yes</td>
<td>The <a href="../../inventory/host_groups"><code>host_group</code></a> representing the zookeeper quorum. This group must contain the hosts acting as zookeeper servers.<br>This group should have the <code>force_setup</code>flag set to `yes</td>
</tr>
<tr>
<td>kafka_version</td>
<td>yes</td>
<td>Specify the Kafka version. May be <code>0.10.0</code>, <code>1.0.0</code>, <code>1.1.1</code> or <code>2.0.0</code>. If your current version does not strictly match one of theses, you may try to select immediate previous version (i.e. use <code>0.10.0</code> for <code>0.11.0</code>).</td>
</tr>
<tr>
<td>zk_port</td>
<td>no</td>
<td>The zookeeper client port.<br>Default: <code>2181</code></td>
</tr>
<tr>
<td>zk_path</td>
<td>no</td>
<td>The root path of Kafka in zookeeper.<br>Default:<code>'/'</code></td>
</tr>
<tr>
<td>broker_id_map</td>
<td>no</td>
<td>With Kafka, each broker is identified with an id. When creating a Topic, one can let Kafka distribute partition's replica across the cluster. But, we may also need to specify explicitly the distribution of replica, with strict location rules.<br>In such case, we need to specify brokers at topic creation, using <code>broker_id</code>. As these <code>broker_id</code> are infrastructure dependent, our application deployment description would be tightly coupled to the target infrastructure.<br>To prevent, this, we introduce here a level of indirection, by a map where each key is a virtual <code>broker_id</code> (used in <code>assignment</code> in topic definition) and the value is the effective one.<br>If this map is not defined, then the virtual <code>broker_id</code> are same as the effective ones.</td>
</tr>
<tr>
<td>tools_folder</td>
<td>no</td>
<td>Folder used by HADeploy to install some tools for Kafka management.<br>Default: <code>/tmp/hadeploy_&lt;user&gt;/</code> where <code>user</code> is the <a href="../../inventory/hosts"><code>ssh_user</code></a> defined for this relay host.</td>
</tr>
<tr>
<td>become_user</td>
<td>no</td>
<td>A user account under which all kafka operations will be performed..<br>Note: The <a href="../../inventory/hosts"><code>ssh_user</code></a> defined for this relay host must have enough rights to switch to this <code>become_user</code> using the <code>become_method</code> below.<br>Default: No user switch, so the <a href="../../inventory/hosts"><code>ssh_user</code></a> defined for this relay host will be used.</td>
</tr>
<tr>
<td>become_method</td>
<td>no</td>
<td>The method used to swith to this user. Refer to the Ansible documentation on this parameter.<br>Default: Ansible default (<code>sudo</code>).</td>
</tr>
<tr>
<td>when</td>
<td>no</td>
<td>Boolean. Allow <a href="../../../more/conditional_deployment">conditional deployment</a> of this item.<br>Default <code>True</code></td>
</tr>
</tbody>
</table>
<h2 id="kerberos-authentication">Kerberos authentication</h2>
<p>HADeploy Kafka topics management need access to Zookeeper. When Kerberos is activated on the target cluster, such access may be protected and forbidden for your deployment user. </p>
<p>In such case, solution is to act as <code>kafka</code> user, by using the <code>become_user</code> attribute.</p>
<p>But keep in mind The <a href="../../inventory/hosts"><code>ssh_user</code></a> defined for this relay host must have enough rights to switch to <code>kafka</code> user account using the <code>become_method</code>.</p>
<h2 id="example">Example</h2>
<p>The simplest case:</p>
<pre><code class="yaml">kafka_relay:
  host: br1
  zk_host_group: zookeepers
  kafka_version: &quot;1.0.0&quot;
</code></pre>

<p>The simplest case when Kerberos is activated:</p>
<pre><code class="yaml">kafka_relay:
  host: br1
  zk_host_group: zookeepers
  kafka_version: &quot;1.0.0&quot;
  become_user: kafka
</code></pre>

<p>A more complex, with default value set and a <code>broker_id</code> mapping (Typical of an Hortonworks Kafka deployment).</p>
<pre><code class="yaml">kafka_relay:
  host: br1
  zk_host_group: zookeepers
  kafka_version: &quot;0.10.0&quot;
  zk_port: 2181
  broker_id_map:
    1: 1001
    2: 1002
    3: 1003
</code></pre>

<h2 id="tricks">Tricks</h2>
<h3 id="kdescribe">kdescribe</h3>
<p>To find the <code>broker_ids</code> values, one may use the <a href="https://github.com/Kappaware/kdescribe"><code>kdescribe</code></a> tool:</p>
<h3 id="ansibleundefinedvariable">AnsibleUndefinedVariable</h3>
<p>If, when running HADeploy you encounter error like:</p>
<pre><code class="bash">fatal: [dn1]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;failed&quot;: true, &quot;msg&quot;: &quot;AnsibleUndefinedVariable: 'dict object' has no attribute 'ansible_fqdn'&quot;}
</code></pre>

<p>it is most likely that you have not set <code>force_setup</code> on the <code>zk_host_group</code> group  </p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
